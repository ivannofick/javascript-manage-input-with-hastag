<html>
  <head>
    Halo
  </head>
  <body>
    <div style="height: 12rem; width: 39rem">
      <input
        id="changed"
        onkeydown="changedString(this)"
        style="height: 12rem; width: 39rem"
      />
      <ul
        style="
          height: 12rem;
          width: 39rem;
          margin: 0px;
          padding: 0;
          display: none;
        "
        id="dropdown-list"
      ></ul>
    </div>

    <script>
      var dropdownList = document.getElementById("dropdown-list");
      var idInput = document.getElementById("changed");
      var positionCursor = 0;

      /**
       * cursor position https://stackoverflow.com/questions/54381318/get-index-of-marked-text-in-edittext-android-studio-kotlin
       * get char https://stackoverflow.com/questions/50297288/how-can-i-access-a-char-in-string-in-at-specific-number
       *
       *
       * */
      function changedString(event) {
        var valuesData = event.value;
        if (valuesData !== "") {
          var cursorPosition = idInput.selectionStart;
          var inputValue = idInput.value;
          if (inputValue.charAt(cursorPosition - 1) === "#") {
            positionCursor = cursorPosition;
            makeListInput();
          } else {
            idInput.addEventListener(
              "keypress",
              function (event) {
                if (event.key === "#") {
                  positionCursor = cursorPosition;
                  makeListInput();
                }
              },
              false
            );
          }
        }
      }
      function makeListInput() {
        dropdownList.style.display = "block";
        var arrayList = ["trondol", "balap", "liar", "motor"];
        dropdownList.innerHTML = "";
        arrayList.forEach((valArr, index) => {
          dropdownList.innerHTML += `<li onclick='selectedList(this)' data-valData='${valArr}'>${valArr}</li>`;
        });
      }
      function selectedList(event) {
        var inputValue = idInput.value+" ";
        if (inputValue.endsWith("#")) {
          var textBefore = inputValue.substring(0, positionCursor + 1);
          var newText = textBefore + event.getAttribute("data-valData") + " ";
          idInput.value = newText.replace(/\s+$/, '')+" ";
        } else {
          var textBefore = inputValue.substring(0, positionCursor);
          var textBetween = inputValue.substring(0, positionCursor + 1);
          var textAfter = inputValue.substring(positionCursor);
          let posTextAfter = textAfter.indexOf(" ");
          let removedAfterString = textAfter.substring(posTextAfter);
          var newText = textBefore + event.getAttribute("data-valData") + removedAfterString;
          if (textBetween.charAt(positionCursor - 1) !== "#") {
            newText =  textBetween+ event.getAttribute("data-valData") + removedAfterString;
          }
          idInput.value = newText.replace(/\s+$/, '')+" ";
        }
        dropdownList.style.display = "none";
        idInput.focus()
      }
    </script>
  </body>
</html>
